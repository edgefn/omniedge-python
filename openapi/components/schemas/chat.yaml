
# ----------------------------------------------------------------------
# åŸºç¡€ç»„ä»¶ï¼šå·¥å…·ä¸å‡½æ•°å®šä¹‰ (Agent æ ¸å¿ƒ)
# ----------------------------------------------------------------------
Function:
  type: object
  required: [name]
  properties:
    name:
      type: string
      description: å‡½æ•°åç§°
    description:
      type: string
      description: å‡½æ•°åŠŸèƒ½æè¿°
    parameters:
      type: object
      description: å‡½æ•°å‚æ•°çš„ JSON Schema

Tool:
  type: object
  required: [type, function]
  properties:
    type:
      type: string
      enum: [function]
    function:
      $ref: '#/Function'



# ----------------------------------------------------------------------
# åŸºç¡€ç»„ä»¶ï¼šå¤šæ¨¡æ€å†…å®¹æ”¯æŒ
# ----------------------------------------------------------------------
ContentPart:
  type: object
  required: [type]
  properties:
    type:
      type: string
      enum: [text, image_url, audio_url, video_url]
      description: "å†…å®¹ç±»å‹"
    text:
      type: string
      description: "æ–‡æœ¬å†…å®¹ (å½“ type=text æ—¶)"
    image_url:
      type: object
      description: "å›¾åƒURLä¿¡æ¯ (å½“ type=image_url æ—¶)"
      properties:
        url:
          type: string
          description: "å›¾åƒURL"
        detail:
          type: string
          enum: [auto, low, high]
          default: auto
          description: "å›¾åƒç»†èŠ‚çº§åˆ«"
    audio_url:
      type: object
      description: "éŸ³é¢‘URLä¿¡æ¯ (å½“ type=audio_url æ—¶)"
      properties:
        url:
          type: string
          description: "éŸ³é¢‘URL"
        format:
          type: string
          description: "éŸ³é¢‘æ ¼å¼"
    video_url:
      type: object
      description: "è§†é¢‘URLä¿¡æ¯ (å½“ type=video_url æ—¶)"
      properties:
        url:
          type: string
          description: "è§†é¢‘URL"
        format:
          type: string
          description: "è§†é¢‘æ ¼å¼"

# ----------------------------------------------------------------------
# åŸºç¡€ç»„ä»¶ï¼šæ¶ˆæ¯å¯¹è±¡ (å‡çº§ç‰ˆï¼Œæ”¯æŒ Tool Calls)
# ----------------------------------------------------------------------
ChatCompletionMessage:
  type: object
  required: [role]
  properties:
    role:
      type: string
      enum: [system, user, assistant, tool, function]
    content:
      oneOf:
        - type: string
          description: "æ–‡æœ¬å†…å®¹"
        - type: array # æ”¯æŒå¤šæ¨¡æ€ (å›¾ç‰‡/æ–‡æœ¬)
          items:
            $ref: '#/ContentPart'
      nullable: true # å…è®¸ä¸ºç©º (å½“ tool_calls å­˜åœ¨æ—¶)
    name:
      type: string
    # ğŸ‘‡ æ–°å¢ï¼šæ¨¡å‹ç”Ÿæˆçš„å·¥å…·è°ƒç”¨è¯·æ±‚
    tool_calls:
      type: array
      items:
        type: object
        properties:
          id: {type: string}
          type: {type: string}
          function:
            type: object
            properties:
              name: {type: string}
              arguments: {type: string} # JSON å­—ç¬¦ä¸²
    # ğŸ‘‡ æ–°å¢ï¼šTool æ¶ˆæ¯å¯¹åº”çš„è°ƒç”¨ ID
    tool_call_id:
      type: string

# ----------------------------------------------------------------------
# è¯·æ±‚å¯¹è±¡ (å·¥ä¸šçº§å®Œå…¨ä½“)
# ----------------------------------------------------------------------
CreateChatCompletionRequest:
  type: object
  required:
    - model
    - messages
  properties:
    # --- 1. æ ¸å¿ƒè·¯ç”± (OpenRouter é£æ ¼) ---
    model:
      description: |
        æ¨¡å‹ IDã€‚
        - å­—ç¬¦ä¸²: æŒ‡å®šå•ä¸€æ¨¡å‹ (å¦‚ "openai/gpt-4o")ã€‚
        - æ•°ç»„: å¼€å¯è‡ªåŠ¨å®¹ç¾ (å¦‚ ["openai/gpt-4o", "anthropic/claude-3"])ã€‚
      oneOf:
        - type: string
          example: "openai/gpt-4o"
        - type: array
          items: {type: string}
          minItems: 1
          example: ["openai/gpt-4o", "google/gemini-pro"]

    messages:
      type: array
      items:
        $ref: '#/ChatCompletionMessage'

    route:
      type: string
      enum: [fallback, round_robin, least_latency]
      default: fallback
      description: "å¤šæ¨¡å‹è·¯ç”±ç­–ç•¥ (fallback=é¡ºåºå®¹ç¾, round_robin=è´Ÿè½½å‡è¡¡)"

    provider:
      type: object
      description: "ä¸Šæ¸¸æœåŠ¡å•†ç‰¹å®šé…ç½® (éšç§/å‚æ•°æ ¡éªŒ)"
      properties:
        require_parameters: {type: boolean}
        data_collection: {type: string, enum: [deny, allow]}
        allow_fallbacks: {type: boolean}

    # --- 2. ç”Ÿæˆæ§åˆ¶ (OpenAI æ ‡å‡†) ---
    temperature:
      type: number
      default: 1.0
      minimum: 0.0
      maximum: 2.0
      description: "é‡‡æ ·æ¸©åº¦ (0.0=ç¡®å®šæ€§, 2.0=éšæœºæ€§)"

    top_p:
      type: number
      default: 1.0
      description: "æ ¸é‡‡æ · (Nucleus Sampling)ï¼Œå»ºè®®ä¸ temperature äºŒé€‰ä¸€"

    n:
      type: integer
      default: 1
      description: "ä¸ºæ¯æ¡è¾“å…¥ç”Ÿæˆå¤šå°‘æ¡å›å¤"

    max_tokens:
      type: integer
      minimum: 1
      nullable: true
      description: "æœ€å¤§ç”Ÿæˆé•¿åº¦"

    stop:
      description: "åœæ­¢åºåˆ— (æœ€å¤š 4 ä¸ª)"
      oneOf:
        - type: string
        - type: array
          items: {type: string}
          maxItems: 4

    presence_penalty:
      type: number
      default: 0
      minimum: -2.0
      maximum: 2.0
      description: "å­˜åœ¨æƒ©ç½š (é¼“åŠ±è°ˆè®ºæ–°è¯é¢˜)"

    frequency_penalty:
      type: number
      default: 0
      minimum: -2.0
      maximum: 2.0
      description: "é¢‘ç‡æƒ©ç½š (å‡å°‘å¤è¯»æœºç°è±¡)"

    repetition_penalty:
      type: number
      default: 1.0
      minimum: 0.0
      maximum: 2.0
      description: "é‡å¤æƒ©ç½š (1.0=æ— æƒ©ç½š, >1.0=å‡å°‘é‡å¤)"

    top_k:
      type: integer
      minimum: 1
      maximum: 100
      description: "Top-Ké‡‡æ · (åªä»æ¦‚ç‡æœ€é«˜çš„Kä¸ªtokenä¸­é€‰æ‹©)"

    logit_bias:
      type: object
      description: "è°ƒæ•´ç‰¹å®š Token çš„ç”Ÿæˆæ¦‚ç‡ (Token ID -> Bias Value)"
      additionalProperties:
        type: integer

    user:
      type: string
      description: "ç»ˆç«¯ç”¨æˆ· ID (ç”¨äºé£æ§å’Œå®¡è®¡)"

    # --- 3. é«˜çº§åŠŸèƒ½ (æ ¼å¼/å·¥å…·/æµå¼) ---
    response_format:
      type: object
      description: "å¼ºåˆ¶è¾“å‡ºæ ¼å¼ (å¦‚ JSON)"
      properties:
        type:
          type: string
          enum: [text, json_object]

    seed:
      type: integer
      nullable: true
      description: "éšæœºç§å­ (ç”¨äºå°½åŠ›å¤ç°ç»“æœ)"

    tools:
      type: array
      description: "æ¨¡å‹å¯ç”¨çš„å·¥å…·åˆ—è¡¨"
      items:
        $ref: '#/Tool'

    tool_choice:
      description: "å¼ºåˆ¶æ¨¡å‹è°ƒç”¨ç‰¹å®šå·¥å…·æˆ–è‡ªåŠ¨é€‰æ‹©"
      oneOf:
        - type: string
          enum: [none, auto, required]
        - type: object
          properties:
            type: {type: string, enum: [function]}
            function:
              type: object
              properties:
                name: {type: string}

    # --- 4. æµå¼å“åº” ---
    stream:
      type: boolean
      default: false
      description: "æ˜¯å¦å¯ç”¨æµå¼å“åº”"

    stream_options:
      type: object
      description: "æµå¼å“åº”é€‰é¡¹"
      properties:
        include_usage:
          type: boolean
          default: false
          description: "æ˜¯å¦åœ¨æµå¼å“åº”çš„æœ€ååŒ…å«ä½¿ç”¨é‡ç»Ÿè®¡"

# ----------------------------------------------------------------------
# å“åº”å¯¹è±¡ (æ™®é€š)
# ----------------------------------------------------------------------
ChatCompletionResponse:
  type: object
  properties:
    id: {type: string}
    object: {type: string, enum: [chat.completion]}
    created: {type: integer}
    model: {type: string}
    system_fingerprint: {type: string}
    choices:
      type: array
      items:
        type: object
        properties:
          index: {type: integer}
          message:
            $ref: '#/ChatCompletionMessage'
          finish_reason:
            type: string
            enum: [stop, length, tool_calls, content_filter, null]
            description: "å®ŒæˆåŸå› : stop=è‡ªç„¶ç»“æŸ, length=é•¿åº¦é™åˆ¶, tool_calls=å·¥å…·è°ƒç”¨, content_filter=å†…å®¹è¿‡æ»¤"
    usage:
      type: object
      properties:
        prompt_tokens: {type: integer}
        completion_tokens: {type: integer}
        total_tokens: {type: integer}

# ----------------------------------------------------------------------
# æµå¼å“åº”å¯¹è±¡ (Server-Sent Events)
# ----------------------------------------------------------------------
ChatCompletionStreamChunk:
  type: object
  properties:
    id: {type: string}
    object:  # æ”¹ä¸ºå®‰å…¨çš„å­—æ®µå
         type: string
         enum: [ chat.completion.chunk ]
         x-speakeasy-name-override: "object"
    created: {type: integer}
    model: {type: string}
    system_fingerprint: {type: string}
    choices:
      type: array
      items:
        type: object
        properties:
          index: {type: integer}
          delta:
            type: object
            properties:
              role: {type: string, enum: [system, user, assistant, tool]}
              content: {type: string}
              tool_calls:
                type: array
                items:
                  type: object
                  properties:
                    index: {type: integer}
                    id: {type: string}
                    type: {type: string}
                    function:
                      type: object
                      properties:
                        name: {type: string}
                        arguments: {type: string}
          finish_reason:
            type: string
            enum: [stop, length, tool_calls, content_filter]
            nullable: true
    usage:
      type: object
      nullable: true
      properties:
        prompt_tokens: {type: integer}
        completion_tokens: {type: integer}
        total_tokens: {type: integer}


# ----------------------------------------------------------------------
# 2. æ–°å¢ï¼šSSE åè®®åŒ…è£…å™¨ (è¿™å°±æ˜¯è§£å†³æŠ¥é”™çš„å…³é”®ï¼)
# ----------------------------------------------------------------------
ChatCompletionStreamEvent:
  type: object
  properties:
    # å‘Šè¯‰ Speakeasyï¼šSSE çš„ data å­—æ®µå†…å®¹ç¬¦åˆ ChatCompletionStreamChunk ç»“æ„
    data:
      $ref: '#/ChatCompletionStreamChunk'
    # å¯é€‰ï¼šå®šä¹‰ raw bytes æˆ– stringï¼Œå› ä¸º SSE data ä¼ è¾“çš„æ˜¯å­—ç¬¦ä¸²ï¼Œ
    # ä½† Speakeasy è¶³å¤Ÿèªæ˜ï¼Œèƒ½å¤„ç† JSON schema refã€‚


