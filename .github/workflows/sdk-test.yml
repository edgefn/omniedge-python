name: test SDK python

on:
  pull_request:
    paths:
        - 'tests/**'           # æµ‹è¯•ä»£ç å˜åŠ¨æ—¶è§¦å‘
        - 'src/**'             #SDK æºç å˜åŠ¨æ—¶è§¦å‘
        # - 'pyproject.toml'     #ä¾èµ–å˜åŠ¨æ—¶è§¦å‘
  workflow_dispatch:

jobs:
  test:
    name: Run Pytest
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'
          # ğŸ‘‡ å…³é”®ä¿®æ­£ï¼šæŒ‡å®šå­ç›®å½•è·¯å¾„
          cache-dependency-path: pyproject.toml

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install . 
          pip install pytest pytest-asyncio

      - name: Run Tests
        env:
          SPEAKEASY_API_KEY: ${{ secrets.SPEAKEASY_API_KEY }}
          BASE_URL: ${{ secrets.OMNIEDGE_BASE_URL }}
          OMNIEDGE_API_KEY: ${{ secrets.OMNIEDGE_API_KEY }}

        run: |
          pytest